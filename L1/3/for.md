# [Назад](/L1/L1_.md)

## в чем особенность области видимости цикла for

### Ответ

- переменные объявленные в условии или в теле цикла доступны только в теле цикла
- Переменные, объявленные в инициализирующем операторе , переиспользуются в каждом цикле.

Что означает:

Переменные созданные в условии цикла `for` не меняют адрес но меняют значение.

Или по другому:

(Это означает, что, когда программа запущена, существует только один объект или кусок памяти для переменной i, а не создается новый для каждого цикла. Этот объект принимает новое значение на каждой итерации.)

С версии go 1.22 будут изменения: в цикле for, переменные будут иметь область действия для каждой итерации, а не для каждого цикла.

-----------------------------------------------------

### Доп информация

Описание проблемы:

https://go.dev/blog/loopvar-preview

https://github.com/golang/go/wiki/CommonMistakes 


-----------------------------------------------------

```go
func main() {
    done := make(chan bool)

    values := []string{"a", "b", "c"}
    for _, v := range values {
        go func() {
            fmt.Println(v)
            done <- true
        }()
    }

    // wait for all goroutines to complete before exiting
    for _ = range values {
        <-done
    }
}
```

```cmd
Ответ:
c
c
c
```

Можно ошибочно ожидать увидеть `a`, `b`, `c` результат. Вместо этого вы, вероятно, увидите `c`, `c`, `c`. Это связано с тем, что каждая итерация цикла использует один и тот же экземпляр переменной `v`, поэтому каждое замыкание использует эту единственную переменную. Когда закрытие запускается, оно печатает значение `v` в момент вызова `fmt.Println()`, но  `v` могло быть уже изменено с момента запуска горутины.

-----------------------------------------------------

Особенность области видимости цикла `for` то, что переменные, объявленные в инициализации цикла `for`, ограничены и доступны только внутри этого цикла и увеличиваются после каждого цикла.
Переменные в условии цикла не меняют адрес но меняют значение
Переменные инициализированные внутри цикла имеют разные адреса

package main

import (
 "fmt"
)

func main() {
 for i, r := range []int{1, 2, 3, 4} {
  var у1 int = 123
  fmt.Println(у1, &у1)
  fmt.Println(i, &i, r, &r)
 }

}

Вывод:
123 0xc000012048
0 0xc000012028 1 0xc000012040
123 0xc000012058
1 0xc000012028 2 0xc000012040
123 0xc000012070
2 0xc000012028 3 0xc000012040
123 0xc000012078
3 0xc000012028 4 0xc000012040
